#!/bin/bash

t=${1:-3}

echo "*** starting foobar service in $t seconds***"
sleep $t

rm -f /tmp/foobar.fifo && mkfifo /tmp/foobar.fifo
systemd-notify --ready --status="Waiting for data..."
while : ; do
    read a </tmp/foobar.fifo
    systemd-notify --status="Processing $a"
    echo "Read from FIFO: $a"
    if [ ${a:0:1} == "q" ]; then
        exit 0
    fi
    systemd-notify --status="Waiting for data..."
done
